---
description: Project conventions for There Be Observables - a reactive programming experiment
globs: ["**/*.ts", "**/*.tsx"]
---

# There Be Observables - Project Rules

> **SYNC RULE**: This file is derived from `CLAUDE.md` (source of truth).
> If you edit this file, also update `CLAUDE.md`. If editing project docs, prefer editing `CLAUDE.md` first.
> A pre-commit hook runs `scripts/sync-agent-files.js` as a backup.

## Project Context

This is **an experiment in exploring reactive programming limits and SE boundaries**, not just a game. The architecture deliberately pushes RxJS to handle everything as streams.

### The Boundaries Concept

"Boundaries" = the pragmatic paradigm shift where functional programming must yield to imperative mutations. The `.subscribe()` calls are boundary crossings where pure streams meet Three.js mutations.

**Preserve this experimental architecture** - don't "fix" the reactive approach unless specifically asked.

## Code Conventions

### RxJS Patterns (Follow These)

```typescript
// Game clock - everything derives from this
const gameClock$ = interval(1000 / FPS, animationFrameScheduler);

// Physics via scan
velocity$.pipe(
  scan((vel, acc) => vel.clone().add(acc), initialVelocity)
);

// Input via merged events
const keyPressed = (key) => merge(
  keyDown$.pipe(filter(e => e.code === key), mapTo(true)),
  keyUp$.pipe(filter(e => e.code === key), mapTo(false))
).pipe(distinctUntilChanged());
```

### Boundary Pattern (Imperative Side Effects)

Keep side effects in `.subscribe()` blocks:
```typescript
velocity$.subscribe(v => model.position.add(v)); // Boundary crossing
```

### Testing with RxJS TestScheduler

```typescript
const scheduler = new TestScheduler((a, e) => expect(a).toEqual(e));
scheduler.run(({ cold, expectObservable }) => {
  // Marble testing
});
```

## File Organization

- `src/Client/` - Input handling, scene management
- `src/Spacecraft/` - Entity factories with physics streams
- `src/Physics/` - Pure calculation functions
- `src/Graphics/` - Three.js mesh factories
- `src/Game/` - Constants, scoring

## Known Technical Debt

- `ImageUtils.loadTexture()` deprecated - needs `TextureLoader`
- Typos: `collitionDetection`, `Atmoshpere`
- `@ts-ignore` in PlayerObject.ts, ScoreKeeping.ts
- All dependencies from 2019, significantly outdated

## Commands

```bash
npm start    # Dev server
npm test     # Jest tests  
npm run lint # ESLint
npm run build # Production build
```
