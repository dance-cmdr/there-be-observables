---
description: Project conventions for There Be Observables - a reactive programming experiment
globs: ["**/*.ts", "**/*.tsx"]
---

# There Be Observables - Project Rules

## Project Context

This is **an experiment in exploring the limits of reactive programming** and the software engineering concept of **boundaries**. It's a 2-player WebGL space battle game, but the game itself is secondary to the architectural experiment.

### The Experiment

The project pushes RxJS to its limits by implementing everything as observable streams:
- Game loop: `interval(1000/60, animationFrameScheduler)`
- Physics: velocity/acceleration computed through `scan` and `withLatestFrom`
- Input: keyboard state via merged `fromEvent` observables
- Collisions: raycasting results flowing through reactive pipelines
- Entity lifecycle: spawn/death via subscribe/unsubscribe

### Boundaries Concept

"Boundaries" describes the pragmatic paradigm shift between functional and imperative programming. You can't stay purely functional - at some point you must mutate state.

**The `.subscribe()` calls are the boundary crossings** - where pure RxJS streams meet Three.js mutations:
- `velocity$.subscribe(v => model.position.add(v))` 
- `renderer.render(scene, camera)`
- `prj.visible = true`

**The experiment asks**: How far out can you push the boundary? What stays functional, what must be imperative?

## Code Patterns

### Game Clock Pattern
```typescript
const gameClock$ = interval(1000 / FPS, animationFrameScheduler);
// Everything subscribes to this - physics, rendering, collision checks
```

### Physics as Stream Composition
```typescript
const velocity$ = gameClock$.pipe(
  withLatestFrom(acceleration$),
  scan((vel, acc) => vel.add(acc).add(gravity), initialVelocity)
);
```

### Input Handling
```typescript
const keyPressed = (key) => merge(
  keyDown$.pipe(filter(e => e.code === key), map(() => true)),
  keyUp$.pipe(filter(e => e.code === key), map(() => false))
).pipe(distinctUntilChanged());
```

### Boundary Crossing (Imperative Side Effects)
```typescript
velocity$.subscribe(velocity => {
  model.position.add(velocity);  // <-- THE BOUNDARY
});
```

## Known Technical Debt



## Commands

```bash
npm install          # Install dependencies
npm run dev          # Dev server at localhost:8080
npm run build        # Production build to dist/
npm test             # Run Vitest tests
npm run lint         # ESLint check
npm run lint:fix     # ESLint auto-fix
```

---
*Auto-generated from CLAUDE.md by scripts/sync-agent-files.js*
